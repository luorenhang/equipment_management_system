# 管理者账号注册和登录功能实现计划

## 一、功能需求
实现管理者账号的注册和登录功能，包括：
1. 管理者账号注册
2. 管理者账号登录
3. 基于JWT的认证机制
4. 网关层统一认证过滤
5. 基于角色的权限控制

## 二、技术选型
- **认证框架**：Spring Security + JWT
- **权限模型**：RBAC（基于角色的权限控制）
- **数据库**：MySQL
- **ORM框架**：MyBatis

## 三、实现步骤

### 1. 公共模块（common）修改
- 添加用户实体类（User）
- 添加角色实体类（Role）
- 添加权限实体类（Permission）
- 添加JWT工具类
- 添加认证相关枚举类
- 添加统一响应结果类

### 2. 用户服务模块（user-service）创建
- 创建用户服务模块
- 实现用户注册功能
- 实现用户登录功能
- 实现用户信息查询功能
- 实现角色和权限管理功能

### 3. 网关服务（gateway-service）修改
- 添加JWT认证过滤器
- 配置不需要认证的路径
- 实现认证失败的统一处理

### 4. 各业务服务修改
- 添加认证依赖
- 实现方法级别的权限控制
- 添加上下文获取当前登录用户信息

### 5. 数据库设计
- 创建用户表（t_user）
- 创建角色表（t_role）
- 创建权限表（t_permission）
- 创建用户角色关联表（t_user_role）
- 创建角色权限关联表（t_role_permission）

## 四、核心代码实现

### 1. 用户实体类设计
```java
@Data
@AllArgsConstructor
@NoArgsConstructor
@TableName("t_user")
public class User {
    @TableId(type = IdType.AUTO)
    private Long id;
    private String username;
    private String password;
    private String email;
    private String phone;
    private Integer status;
    private Integer isAdmin;
    private Date createTime;
    private Date updateTime;
}
```

### 2. JWT工具类
```java
public class JwtUtils {
    // JWT生成和验证方法
}
```

### 3. 网关认证过滤器
```java
@Component
public class AuthFilter implements GlobalFilter, Ordered {
    // 实现认证过滤逻辑
}
```

### 4. 登录接口
```java
@PostMapping("/login")
public Result<LoginVo> login(@RequestBody LoginDto loginDto) {
    // 实现登录逻辑
}
```

## 五、部署和测试
1. 启动Nacos服务
2. 启动MySQL数据库
3. 运行用户服务
4. 运行网关服务
5. 运行其他业务服务
6. 测试注册和登录功能
7. 测试权限控制功能

## 六、安全考虑
1. 密码加密存储（使用BCrypt）
2. JWT过期时间设置
3. 敏感接口的权限控制
4. 防止SQL注入
5. 防止XSS攻击

## 七、预期效果
1. 管理者可以注册账号
2. 管理者可以登录系统
3. 未登录用户无法访问受保护资源
4. 基于角色的权限控制生效
5. 各服务间认证信息传递正常